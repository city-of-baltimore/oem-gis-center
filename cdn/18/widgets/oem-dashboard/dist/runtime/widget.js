System.register(["jimu-core/react","jimu-arcgis","jimu-ui","esri/layers/FeatureLayer","esri/layers/Layer","esri/Basemap","esri/identity/OAuthInfo","esri/identity/IdentityManager","esri/widgets/LayerList","jimu-ui/basic/color-picker","esri/Color","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/core/reactiveUtils"],(function(e,t){var r={},a={},i={},s={},o={},n={},l={},c={},d={},p={},u={},m={},h={},y={};return{setters:[function(e){r.Component=e.Component,r.default=e.default},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.AdvancedSelect=e.AdvancedSelect,i.Button=e.Button,i.CollapsablePanel=e.CollapsablePanel,i.Dropdown=e.Dropdown,i.DropdownButton=e.DropdownButton,i.DropdownItem=e.DropdownItem,i.DropdownMenu=e.DropdownMenu,i.Icon=e.Icon,i.Loading=e.Loading,i.Modal=e.Modal,i.ModalBody=e.ModalBody,i.ModalFooter=e.ModalFooter,i.ModalHeader=e.ModalHeader,i.Slider=e.Slider,i.Tab=e.Tab,i.Tabs=e.Tabs,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip},function(e){s.default=e.default},function(e){o.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){c.default=e.default},function(e){d.default=e.default},function(e){p.ColorPicker=e.ColorPicker},function(e){u.default=e.default},function(e){m.default=e.default},function(e){h.default=e.default},function(e){y.default=e.default}],execute:function(){e((()=>{var e={208:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(81),i=r.n(a),s=r(645),o=r.n(s)()(i());o.push([e.id,"#layer-component .layer-tabs{margin-top:10px}#layer-component .layer-tabs__content{height:calc(100% - 139px);width:calc(100% - 16px);overflow-y:auto;position:absolute}#layer-component #layer-search{margin-top:10px}#layer-component #layer-search .dropdown-button:hover{border-color:var(--primary-500)}\n",""]);const n=o},55:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(81),i=r.n(a),s=r(645),o=r.n(s)()(i());o.push([e.id,'#layer-list-component #no-layers-message{background-color:#edf7f9;padding:5px}#layer-list-component .esri-layer-list{height:calc(100vh - 250px);overflow-y:auto;background-color:var(--white)}#layer-list-component .esri-layer-list .esri-layer-list__no-items{display:none}#layer-list-component .esri-layer-list .esri-layer-list__item{background-color:var(--white)}#layer-list-component .esri-layer-list .esri-layer-list__item-container{padding-left:0;animation:new-item 5s ease-out;border:none}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label{position:relative;cursor:move}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label .esri-layer-list__item-toggle{position:absolute;height:100%}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label .esri-layer-list__item-toggle:hover{background-color:var(--secondary-100)}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label .esri-layer-list__item-title{margin-left:25px}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label .esri-icon-non-visible{color:var(--light-800)}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-label:has(.esri-icon-non-visible){color:var(--light-800)}#layer-list-component .esri-layer-list .esri-layer-list__item-container .esri-layer-list__item-actions-menu-item--active[aria-label="Legend"]{transform:rotate(180deg)}#layer-list-component .esri-layer-list .esri-layer-list-panel{margin:0 0 5px 27px;background-color:var(--light)}#layer-list-component .esri-layer-list .esri-layer-list-panel .esri-layer-list-panel__content{padding:5px 0 5px 10px}#layer-list-component .esri-layer-list .esri-layer-list-panel .esri-layer-list-panel__content:has(.legend__templates){border-top:2px var(--light-300) solid}#layer-list-component .esri-layer-list .esri-layer-list-panel .esri-legend{background-color:transparent}#layer-list-component .esri-layer-list .esri-layer-list-panel .esri-legend__service{padding:0}#layer-list-component .esri-layer-list .esri-layer-list-panel .esri-legend__layer-child-table{margin:0}#layer-list-component .esri-layer-list .esri-layer-list__item-actions{background-color:var(--light)}#layer-list-component .esri-layer-list .esri-layer-list__item-actions .esri-layer-list__item-actions-list .esri-disabled-element,#layer-list-component .esri-layer-list .esri-layer-list__item-actions .esri-layer-list__item-actions-list .esri-disabled-element:hover{color:var(--light-800);cursor:default}#layer-list-component #layer-list__buttons{display:grid;grid-template-columns:1fr 80px;grid-template-rows:repeat(2, 50%)}#layer-list-component #layer-list__buttons button{padding:3px}#layer-list-component #layer-list__buttons #clear-all-button-grid-item{grid-column:1;grid-row:1;border-bottom:2px var(--light-300) solid !important}#layer-list-component #layer-list__buttons #clear-all-button-grid-item #clear-all-button{padding-left:0}#layer-list-component #layer-list__buttons #clear-all-button-grid-item #clear-all-button svg{margin-right:0;margin-bottom:2px}#layer-list-component #layer-list__buttons #legend-button-grid-item{grid-column:2;grid-row:1;border-bottom:2px var(--light-300) solid}#layer-list-component #layer-list__buttons #legend-button-grid-item label{font-size:var(--calcite-font-size--1);position:relative;top:4px}#layer-list-component #layer-list__buttons #legend-button-grid-item #legend-button{position:relative;bottom:2px}#layer-list-component #layer-list__buttons #layer-visibility-button-grid-item{grid-column:1;grid-row:2}.color-picker-block{display:inline-block;position:relative;top:11px;left:5px}.layer-size-slider>input{display:inline-block;width:65%;position:relative;top:3px;margin:0 10px}#picture-marker-warning{margin-top:10px}#picture-marker-warning div{margin-top:10px}#show-legend-button:hover:not(.disabled),#hide-legend-button:hover:not(.disabled){color:var(--primary-500)}#legend-button svg{margin-left:0.5rem}.modal-backdrop.fade.show{opacity:0}\n',""]);const n=o},986:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(81),i=r.n(a),s=r(645),o=r.n(s)()(i());o.push([e.id,"#template-component{display:block;padding:10px;background-color:#edf7f9;border:1px var(--dark-800) solid;border-radius:5px}#template-component #template-component__header{margin-bottom:0.5rem}#template-component #template-component__header h4{display:inline}#template-component #template-component__header #template-component__info{display:inline;position:absolute;margin:2px 0 0 5px}#template-component #template-search .dropdown-button:hover{border-color:var(--primary-500)}#template-component #active-templates-menu{height:55px;overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding-top:15px}#template-component #active-templates-menu .scroll-item{max-width:150px}#template-component #active-templates-menu .scroll-item .nav-link{color:var(--dark-800);background-color:var(--white);cursor:default;border:1px var(--dark-800) solid}#template-component #active-templates-menu .tab-title{margin-top:2px}#template-component #active-templates-menu #no-active-templates{padding:5px 0 0 5px}.template-search-item{width:100%}.template-search-item .template-search-item__add-button{width:calc(100% - 55px)}.template-dropdown__content{margin-left:15px;border-left:2px var(--light-300) solid}\n",""]);const n=o},459:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(81),i=r.n(a),s=r(645),o=r.n(s)()(i());o.push([e.id,".jimu-widget{position:relative}.p-5{padding:0.5rem !important}#oem-dashboard-grid{position:absolute;width:100%;height:100%;overflow:hidden;display:grid;grid-template-columns:repeat(2, 50%);grid-template-rows:190px 1fr 60px}#oem-dashboard-grid .grid-item{padding:0.5rem !important;position:relative}#oem-dashboard-grid #template-component__grid-item{grid-column:1;grid-row:1}#oem-dashboard-grid #layer-component__grid-item{grid-column:1;grid-row:2 / 4}#oem-dashboard-grid #layer-list__grid-item{grid-column:2;grid-row:1 / 3;background-color:var(--white)}#oem-dashboard-grid #save-template-grid-item{grid-column:2;grid-row:3;background-color:var(--white)}#oem-dashboard-grid .loading{height:80px;width:200px}.add-button{width:100%;display:block}.add-button .icon-btn-sizer{justify-content:left;text-align:left}.add-button .jimu-icon{margin-right:4px !important;margin-left:0 !important;margin-bottom:3px}#open-save-template-button{width:100%}#open-save-template-button .jimu-icon{margin-bottom:4px}.btn-primary{color:var(--dark-800);background-color:var(--secondary-500);border-color:var(--secondary-500)}.btn-primary:hover{background-color:var(--secondary-200);border-color:var(--secondary-200)}.advanced-select-menu .select-item-placeholder{margin:0 !important;width:0 !important}.dropdown-item:hover{background-color:var(--white) !important}.multiple-select-tool{display:none !important}.jimu-dropdown-item>.jimu-checkbox{display:none !important}@keyframes new-item{from{background-color:var(--secondary-100)}50%{background-color:var(--secondary-100)}to{background-color:transparent}}.modal-content .menu-navigation .nav-link.active{cursor:default}\n",""]);const n=o},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",a=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),a&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),a&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,a,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var n=0;n<this.length;n++){var l=this[n][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&o[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),r&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=r):d[2]=r),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},379:e=>{"use strict";var t=[];function r(e){for(var r=-1,a=0;a<t.length;a++)if(t[a].identifier===e){r=a;break}return r}function a(e,a){for(var s={},o=[],n=0;n<e.length;n++){var l=e[n],c=a.base?l[0]+a.base:l[0],d=s[c]||0,p="".concat(c," ").concat(d);s[c]=d+1;var u=r(p),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var h=i(m,a);a.byIndex=n,t.splice(n,0,{identifier:p,updater:h,references:1})}o.push(p)}return o}function i(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,i){var s=a(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var n=r(s[o]);t[n].references--}for(var l=a(e,i),c=0;c<s.length;c++){var d=r(s[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=l}}},569:e=>{"use strict";var t={};e.exports=function(e,r){var a=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(r)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var a="";r.supports&&(a+="@supports (".concat(r.supports,") {")),r.media&&(a+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(a+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),a+=r.css,i&&(a+="}"),r.media&&(a+="}"),r.supports&&(a+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},673:e=>{"use strict";e.exports=n},639:e=>{"use strict";e.exports=u},135:e=>{"use strict";e.exports=y},380:e=>{"use strict";e.exports=c},263:e=>{"use strict";e.exports=l},818:e=>{"use strict";e.exports=s},195:e=>{"use strict";e.exports=o},232:e=>{"use strict";e.exports=m},511:e=>{"use strict";e.exports=h},447:e=>{"use strict";e.exports=d},826:e=>{"use strict";e.exports=a},315:e=>{"use strict";e.exports=r},726:e=>{"use strict";e.exports=i},362:e=>{"use strict";e.exports=p}},t={};function f(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,f),i.exports}f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var r in t)f.o(t,r)&&!f.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="",f.nc=void 0;var g={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(g),f.d(g,{__set_webpack_public_path__:()=>Te,default:()=>Ee});var e=f(379),t=f.n(e),r=f(795),a=f.n(r),i=f(569),s=f.n(i),o=f(565),n=f.n(o),l=f(216),c=f.n(l),d=f(589),p=f.n(d),u=f(459),m={};m.styleTagTransform=p(),m.setAttributes=n(),m.insert=s().bind(null,"head"),m.domAPI=a(),m.insertStyleElement=c(),t()(u.Z,m),u.Z&&u.Z.locals&&u.Z.locals;var h=f(315),y=f(826),v=f(726),b=f(818),w=f(195),E=f(673),T=function(){return T=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},T.apply(this,arguments)},L=function(e,t){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},L(e,t)},C=function(){return C=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},C.apply(this,arguments)};function _(e){return Object.keys(e).some((function(t){var r=e[t];if(!r)return!1;switch(r&&r.toParam&&(r=r.toParam()),r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function S(e){var t={};return Object.keys(e).forEach((function(r){var a,i,s=e[r];if(s&&s.toParam&&(s=s.toParam()),s||0===s||"boolean"==typeof s||"string"==typeof s){var o;switch(s.constructor.name){case"Array":var n=null===(i=null===(a=s[0])||void 0===a?void 0:a.constructor)||void 0===i?void 0:i.name;o="Array"===n?s:"Object"===n?JSON.stringify(s):s.join(",");break;case"Object":o=JSON.stringify(s);break;case"Date":o=s.valueOf();break;case"Function":o=null;break;case"Boolean":o=s+"";break;default:o=s}(o||0===o||"string"==typeof o||Array.isArray(o))&&(t[r]=o)}})),t}function k(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return k(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function I(e){var t=S(e);return Object.keys(t).map((function(e){return k(e,t[e])})).join("&")}var O=function(e,t,r,a,i){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=a,this.options=i};O.prototype=Object.create(Error.prototype),O.prototype.constructor=O;var x="@esri/arcgis-rest-js",A={httpMethod:"POST",params:{f:"json"}},M=function(e){function t(t,r,a,i,s){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var o=e.call(this,t,r,a,i,s)||this;return o.name="ArcGISAuthError",o.message="AUTHENTICATION_ERROR_CODE"===r?t:r+": "+t,o}return function(e,t){function r(){this.constructor=e}L(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.retry=function(e,t){var r=this;void 0===t&&(t=3);var a=0,i=function(s,o){e(r.url,r.options).then((function(e){var t=C(C({},r.options),{authentication:e});return a+=1,R(r.url,t)})).then((function(e){s(e)})).catch((function(e){"ArcGISAuthError"===e.name&&a<t?i(s,o):"ArcGISAuthError"===e.name&&a>=t?o(r):o(e)}))};return new Promise((function(e,t){i(e,t)}))},t}(O);function R(e,t){void 0===t&&(t={params:{f:"json"}});var r=C(C(C({httpMethod:"POST"},A),t),{params:C(C({},A.params),t.params),headers:C(C({},A.headers),t.headers)}),a=[],i=[];if(r.fetch||"undefined"==typeof fetch?(a.push("`fetch`"),i.push("`node-fetch`")):r.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(a.push("`Promise`"),i.push("`es6-promise`")),"undefined"==typeof FormData&&(a.push("`FormData`"),i.push("`isomorphic-form-data`")),!r.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+a.join(", ")+". We recommend installing the "+i.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var s=r.httpMethod,o=r.authentication,n=r.rawResponse,l=C({f:"json"},r.params),c=null,d={method:s,credentials:r.credentials||"same-origin"};return r.headers&&r.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(d.credentials="include"),(o?o.getToken(e,{fetch:r.fetch}).catch((function(t){return t.url=e,t.options=r,c=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(l.token=t),o&&o.getDomainCredentials&&(d.credentials=o.getDomainCredentials(e));var a={};if("GET"===d.method){l.token&&r.hideToken&&"undefined"==typeof window&&(a["X-Esri-Authorization"]="Bearer "+l.token,delete l.token);var i=""===I(l)?e:e+"?"+I(l);r.maxUrlLength&&i.length>r.maxUrlLength||l.token&&r.hideToken?(d.method="POST",t.length&&r.hideToken&&(l.token=t,delete a["X-Esri-Authorization"])):e=i}var s=new RegExp("/items/.+/updateResources").test(e);return"POST"===d.method&&(d.body=function(e,t){var r=_(e)||t,a=S(e);if(r){var i=new FormData;return Object.keys(a).forEach((function(e){if("undefined"!=typeof Blob&&a[e]instanceof Blob){var t=a.fileName||a[e].name||e;i.append(e,a[e],t)}else a[e].constructor&&"ReadStream"===a[e].constructor.name&&Number.isInteger(a.dataSize)?i.append(e,a[e],{knownLength:a.dataSize}):i.append(e,a[e])})),i}return I(e)}(l,s)),d.headers=C(C({},a),r.headers),"undefined"!=typeof window||d.headers.referer||(d.headers.referer=x),_(l)||s||(d.headers["Content-Type"]="application/x-www-form-urlencoded"),r.fetch(e,d)})).then((function(t){if(!t.ok){var a=t.status,i=t.statusText;throw new O(i,"HTTP "+a,t,e,r)}if(n)return t;switch(l.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==l.f&&"geojson"!==l.f||n)return t;var a=function(e,t,r,a,i){if(e.code>=400){var s=e.message,o=e.code;throw new O(s,o,e,t,a)}if(e.error){var n=e.error,l=(s=n.message,o=n.code,n.messageCode),c=l||o||"UNKNOWN_ERROR_CODE";if(498===o||499===o||"GWM_0003"===l||400===o&&"Unable to generate token."===s)throw i||new M(s,c,e,t,a);throw new O(s,c,e,t,a)}if("failed"===e.status||"failure"===e.status){s=void 0,o="UNKNOWN_ERROR_CODE";try{s=JSON.parse(e.statusMessage).message,o=JSON.parse(e.statusMessage).code}catch(t){s=e.statusMessage||e.message}throw new O(s,o,e,t,a)}return e}(t,e,0,r,c);if(c){var i=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.federatedServers[i]={token:[],expires:new Date(Date.now()+864e5)},c=null}return a}))}function N(e){return R(("string"!=typeof(t=e.url)||"/"===(t=t.trim())[t.length-1]&&(t=t.slice(0,-1)),t+"/addFeatures"),function(e,t,r){var a=C(C({params:{}},r),e);return a.params=["features","gdbVersion","returnEditMoment","rollbackOnFailure"].reduce((function(t,r){return(e[r]||"boolean"==typeof e[r])&&(t[r]=e[r]),t}),a.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce((function(e,t){return a[t]&&(e[t]=a[t]),e}),{})}(e,0,{params:T({},e.params)}));var t}var D=f(263),j=f(380),W=f(208),P={};P.styleTagTransform=p(),P.setAttributes=n(),P.insert=s().bind(null,"head"),P.domAPI=a(),P.insertStyleElement=c(),t()(W.Z,P),W.Z&&W.Z.locals&&W.Z.locals;class B extends h.Component{render(){return h.default.createElement(v.Button,{"aria-label":"Button",icon:!0,onClick:()=>this.props.onAddLayer(this.props.layerWrapper),size:"sm",type:"tertiary",className:"add-button",disabled:this.props.active},h.default.createElement(v.Icon,{icon:this.props.active?"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/check-32.svg":"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/plus-32.svg",size:"l"}),this.props.layerWrapper.title)}}const z=B;class F extends h.Component{render(){return h.default.createElement("div",{id:"layer-search"},h.default.createElement(v.AdvancedSelect,{isMultiple:!0,isEmptyOptionHidden:!0,onChange:function(){},size:"default",sortValuesByLabel:!0,menuProps:{offset:[0,-40]},customDropdownButtonContent:()=>h.default.createElement("div",null,h.default.createElement(v.Icon,{icon:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/search-32.svg"}),"Search for layer..."),staticValues:this.props.layers.map((e=>({label:e.title,value:e.id,render:t=>h.default.createElement(z,{layerWrapper:e,onAddLayer:this.props.onAddLayer,active:this.props.activeLayers.includes(e)})})))}))}}const H=F;class U extends h.Component{constructor(){super(...arguments),this.renderCategoryTabs=()=>this.props.categories.map((e=>h.default.createElement(v.Tab,{id:"category-"+e.id+"-tab",className:"tab",title:e.title+" ("+e.layerWrappers.length+")"},h.default.createElement("div",{id:"category-"+e.id+"-tab-content",className:"layer-tabs__content p-5 border"},e.layerWrappers.map((e=>h.default.createElement(z,{layerWrapper:e,onAddLayer:this.props.onAddLayer,active:this.props.activeLayers.includes(e)})))))))}render(){return h.default.createElement("div",{id:"layer-component"},h.default.createElement("h4",null,"Layers"),this.props.layers&&h.default.createElement(H,{layers:this.props.layers,onAddLayer:this.props.onAddLayer,activeLayers:this.props.activeLayers}),h.default.createElement("div",{className:"layer-tabs"},h.default.createElement(v.Tabs,{onChange:function(){},onClose:function(){},type:"tabs",scrollable:!0},this.props.categories&&this.renderCategoryTabs())))}}const V=U;class J extends h.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.checkValidity=e=>({valid:e.length<=50,msg:"Maximum title length is 50 characters!"}),this.state={title:void 0,open:!1}}render(){return h.default.createElement("div",{id:"save-template-component"},this.props.show&&h.default.createElement(v.Button,{onClick:this.toggleOpen,id:"open-save-template-button",type:"primary"},h.default.createElement(v.Icon,{icon:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/plus-32.svg",size:"l"}),"Save As New Event"),h.default.createElement(v.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},h.default.createElement(v.ModalHeader,{toggle:this.toggleOpen},"Save As New Event"),h.default.createElement(v.ModalBody,null,"Event Title:",h.default.createElement(v.TextInput,{className:"mb-3",placeholder:"Enter Event Title...",onAcceptValue:e=>this.setState({title:e}),checkValidityOnChange:this.checkValidity,checkValidityOnAccept:this.checkValidity})),h.default.createElement(v.ModalFooter,null,h.default.createElement(v.Button,{onClick:this.toggleOpen},"Cancel"),h.default.createElement(v.Button,{onClick:()=>{this.props.handleClick(this.state.title),this.toggleOpen()},id:"save-template-button",type:"primary"},"Save"))))}}const Z=J;var q=f(55),G={};G.styleTagTransform=p(),G.setAttributes=n(),G.insert=s().bind(null,"head"),G.domAPI=a(),G.insertStyleElement=c(),t()(q.Z,G),q.Z&&q.Z.locals&&q.Z.locals;var Y=f(447),K=f(362),X=f(639),Q=f(232),$=f(511);class ee extends h.Component{constructor(e){super(e),this.onOpened=()=>{this.setState({originalRenderer:Q.default.fromJSON(this.props.layer.renderer.toJSON())});let e=this.props.layer.renderer.symbol;switch(e.type){case"simple-marker":"cross"===e.style||"x"===e.style?this.setState({showColorPicker:!0,showSizeSlider:!0,color:e.outline.color.toString(),size:e.size}):this.setState({showColorPicker:!0,showSizeSlider:!0,color:e.color.toString(),size:e.size});break;case"picture-marker":this.setState({showColorPicker:!1,showSizeSlider:!0,color:"#ffffff",size:e.width});break;case"simple-fill":default:this.setState({showColorPicker:!0,showSizeSlider:!1,color:e.color.toString(),size:null});break;case"simple-line":this.setState({showColorPicker:!0,showSizeSlider:!0,color:e.color.toString(),size:e.width})}},this.handleColorWarningClick=()=>{this.setState({showColorPicker:!0}),this.props.layer.renderer.symbol=new $.default({color:this.state.color,size:this.state.size})},this.handleChangeColor=e=>{this.setState({color:e});let t=this.props.layer.renderer;"simple-marker"===t.symbol.type&&("cross"===t.symbol.style||"x"===t.symbol.style)?t.symbol.outline.color=new X.default(e):t.symbol.color=new X.default(e)},this.handleChangeSize=e=>{let t=this.props.layer.renderer;switch(this.setState({size:e}),t.symbol.type){case"simple-marker":t.symbol.size=e;break;case"picture-marker":let r=t.symbol,a=r.height/r.width;r.width=e,r.height=e*a;break;case"simple-line":t.symbol.width=e}},this.handleCancel=()=>{this.props.layer.renderer=this.state.originalRenderer,this.props.toggleOpen()},this.state={showColorPicker:!1,showSizeSlider:!1,color:null,size:null,originalRenderer:null}}render(){return h.default.createElement(v.Modal,{isOpen:this.props.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:this.onOpened,toggle:this.props.toggleOpen},h.default.createElement(v.ModalHeader,{toggle:this.props.toggleOpen},"Edit ",this.props.layer.title," Legend Style"),h.default.createElement(v.ModalBody,null,this.state.showSizeSlider&&h.default.createElement("div",{className:"layer-size-slider"},"Select Marker Size:",h.default.createElement(v.Slider,{"aria-label":"Layer Size Slider",onChange:e=>this.handleChangeSize(+e.target.value),min:0,max:Math.max(50,this.state.size),value:this.state.size}),h.default.createElement("label",null,this.state.size)),this.state.showColorPicker&&h.default.createElement("div",{className:"layer-color-picker"},"Select Marker Color:",h.default.createElement(K.ColorPicker,{"aria-label":"Layer Color Picker",color:this.state.color,height:30,width:30,onChange:e=>this.handleChangeColor(e),onClick:function(){},placement:"bottom",type:"default"})),"picture-marker"===this.props.layer.renderer.symbol.type&&!this.state.showColorPicker&&h.default.createElement("div",{id:"picture-marker-warning"},h.default.createElement(v.Button,{onClick:this.handleColorWarningClick},"Change Color"),h.default.createElement("div",null,h.default.createElement("em",null,"Changing the color of this layer requires converting the marker from a picture to a simple circular marker.")))),h.default.createElement(v.ModalFooter,null,h.default.createElement(v.Button,{onClick:this.handleCancel},"Cancel"),h.default.createElement(v.Button,{onClick:this.props.onSave,id:"save-template-button",type:"primary"},"Save")))}}const te=ee;var re=f(135);class ae extends h.Component{constructor(e){super(e)}render(){return h.default.createElement("div",{id:"layer-list__buttons"},h.default.createElement("div",{id:"clear-all-button-grid-item"},h.default.createElement(v.Button,{"aria-label":"Button",onClick:this.props.onClearAll,size:"default",id:"clear-all-button",type:"tertiary"},"Clear All")),h.default.createElement("div",{id:"legend-button-grid-item"},h.default.createElement(v.Dropdown,null,h.default.createElement(v.DropdownButton,{id:"legend-button",type:"tertiary",arrow:!1},"Legend",h.default.createElement(v.Icon,{icon:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/hamburger-32.svg"})),h.default.createElement(v.DropdownMenu,{alignment:"end"},h.default.createElement(v.DropdownItem,{onClick:this.props.onShowLegend,id:"show-legend-button",type:"tertiary",disabled:this.props.allLegendsOpen},"Show All"),h.default.createElement(v.DropdownItem,{onClick:this.props.onHideLegend,id:"hide-legend-button",type:"tertiary",disabled:this.props.allLegendsClosed},"Hide All")))),h.default.createElement("div",{id:"layer-visibility-grid-item"},h.default.createElement(v.Button,{id:"layer-visibility-button",type:"tertiary",onClick:()=>{this.props.allLayersHidden?this.props.onShowLayers():this.props.onHideLayers()}},h.default.createElement(v.Icon,{icon:this.props.allLayersHidden?"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/view-hide-32.svg":"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/view-visible-32.svg",size:"l"}),this.props.allLayersHidden?"Show All":"Hide All")))}}const ie=ae;class se extends h.Component{constructor(e){super(e),this.onOpened=()=>{return e=this,t=void 0,a=function*(){this.setState({source:"...",description:"...",url:""});let e=yield this.props.getLayerInfo(this.props.layer);e&&this.setState(e)},new((r=void 0)||(r=Promise))((function(i,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function n(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,n)}l((a=a.apply(e,t||[])).next())}));var e,t,r,a},this.state={source:"...",description:"...",url:""}}render(){return h.default.createElement(v.Modal,{isOpen:this.props.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:this.onOpened,toggle:this.props.toggleOpen},h.default.createElement(v.ModalHeader,{toggle:this.props.toggleOpen},this.props.layer.title," Description"),h.default.createElement(v.ModalBody,null,h.default.createElement("div",{className:"layer-source"},"Source: ",this.state.source),h.default.createElement("div",{className:"layer-description"},"Description: ",this.state.description)),h.default.createElement(v.ModalFooter,null,h.default.createElement(v.Button,{onClick:this.props.toggleOpen},"Close"),this.state.url&&h.default.createElement(v.Button,{onClick:()=>window.open(this.state.url,"_blank"),type:"primary"},"See More")))}}const oe=se;class ne extends h.Component{constructor(e){super(e),this.myRef=h.default.createRef(),this.onItemClick=e=>{},this.showLegend=()=>{for(let e of this.state.widget.operationalItems)e.panel.open=!0},this.hideLegend=()=>{for(let e of this.state.widget.operationalItems)e.panel.open=!1},this.showLayers=()=>{for(let e of this.state.widget.operationalItems)e.layer.visible=!0},this.hideLayers=()=>{for(let e of this.state.widget.operationalItems)e.layer.visible=!1},this.changeStyle=()=>{this.refresh(this.state.selectedItem),this.setState({layerStyleModalOpen:!1})},this.createLegendDiv=()=>{let e=document.createElement("div");return e.className="legend__header",e.innerHTML="Legend: ",e},this.createTemplatesDiv=e=>{let t=document.createElement("div");t.className="legend__templates";let r=this.props.getLayerTemplates(e,!0);if(0===r.length)return t.innerHTML="Events: None",t;let a="Events: ";for(let e of r)a+=" "+e.title+",";return t.innerHTML=a.slice(0,-1),t},this.createCategoryDiv=e=>{let t=document.createElement("div");return t.className="legend__category",t.innerHTML="Category: "+this.props.getLayerCategory(e).title,t},this.refresh=e=>{e.parent?e.panel.content=["legend"]:e.panel.content=["legend",this.createTemplatesDiv(e.layer),this.createCategoryDiv(e.layer)]},this.activeViewChangeHandler=e=>{if(this.state.jmv&&this.state.widget&&this.state.widget.destroy(),e&&(this.setState({jmv:e}),this.myRef.current)){const t=new Y.default({view:e.view,listItemCreatedFunction:e=>{return r=this,a=void 0,s=function*(){let r=e.item;r.panel={className:"esri-icon-down"},this.refresh(r),yield r.layer.when(),r.actionsSections=[[{title:"Remove",className:"esri-icon-minus",id:"remove"}],[{title:"Zoom to",className:"esri-icon-zoom-in-magnifying-glass",id:"zoom"}],[{title:"Edit legend style",image:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/layers-editable-24.svg",id:"change-style",disabled:!("feature"===r.layer.type&&"simple"===r.layer.renderer.type&&(null!=r.layer.renderer.symbol.color||"picture-marker"===r.layer.renderer.symbol.type))}],[{title:"Send backwards",image:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/send-backwards-24.svg",id:"send-backwards"},{title:"Bring forward",image:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/bring-forward-24.svg",id:"bring-forward"},{title:"Send to back",image:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/send-to-back-24.svg",id:"send-to-back"},{title:"Bring to front",image:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/bring-to-front-24.svg",id:"bring-to-front"}],[{title:"Description",className:"esri-icon-description",id:"description"}]],r.addHandles([re.default.watch((()=>t.selectedItems.includes(r)),(()=>this.onItemClick(r))),re.default.when((()=>r.panel.open),(()=>r.actionsOpen=!1)),re.default.when((()=>r.actionsOpen),(()=>r.panel.open=!1))])},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function n(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(o,n)}l((s=s.apply(r,a||[])).next())}));var r,a,i,s},container:this.myRef.current,selectionEnabled:!0,multipleSelectionEnabled:!0});t.on("trigger-action",(t=>{const r=t.action.id,a=t.item.layer;let i=this.state.jmv.view.map.layers.findIndex((e=>e===a));switch(r){case"zoom":e.view.goTo(a.fullExtent);break;case"remove":this.props.onRemoveLayer(a);break;case"change-style":this.setState({layerStyleModalOpen:!0,selectedItem:t.item});break;case"send-backwards":i>0&&this.state.jmv.view.map.reorder(a,i-1);break;case"bring-forward":i>-1&&i<this.state.jmv.view.map.layers.length&&this.state.jmv.view.map.reorder(a,i+1);break;case"send-to-back":i>-1&&this.state.jmv.view.map.reorder(a,0);break;case"bring-to-front":i>-1&&this.state.jmv.view.map.reorder(a,this.state.jmv.view.map.layers.length-1);break;case"description":this.setState({moreInfoModalOpen:!0,selectedItem:t.item})}})),t.addHandles([re.default.watch((()=>t.operationalItems.reduce(((e,t)=>e&&!t.layer.visible),!0)),(()=>this.setState({allLayersHidden:t.operationalItems.reduce(((e,t)=>e&&!t.layer.visible),!0)}))),re.default.watch((()=>t.operationalItems.reduce(((e,t)=>e&&t.panel.open),!0)),(()=>this.setState({allLegendsOpen:t.operationalItems.reduce(((e,t)=>e&&t.panel.open),!0)}))),re.default.watch((()=>t.operationalItems.reduce(((e,t)=>e&&!t.panel.open),!0)),(()=>this.setState({allLegendsClosed:t.operationalItems.reduce(((e,t)=>e&&!t.panel.open),!0)})))]),this.setState({widget:t})}},this.state={jmv:null,widget:null,layerStyleModalOpen:!1,moreInfoModalOpen:!1,selectedItem:null,allLayersHidden:!1,allLegendsOpen:!1,allLegendsClosed:!0}}render(){if(this.state.widget)for(let e of this.state.widget.viewModel.operationalItems)this.refresh(e);return h.default.createElement("div",{id:"layer-list-component"},h.default.createElement(y.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetId,onActiveViewChange:this.activeViewChangeHandler}),h.default.createElement("h3",null,"Current Layers ("+this.props.numActiveLayers+")"),this.props.numActiveLayers<=0&&h.default.createElement("div",{id:"no-layers-message"},h.default.createElement("em",null,"You do not have any layers added. Get started by adding a event or layer from the left side of the panel.")),this.props.numActiveLayers>0&&h.default.createElement(ie,{onClearAll:this.props.onClearAll,onHideLegend:this.hideLegend,onShowLegend:this.showLegend,onShowLayers:this.showLayers,onHideLayers:this.hideLayers,allLayersHidden:this.state.allLayersHidden,allLegendsOpen:this.state.allLegendsOpen,allLegendsClosed:this.state.allLegendsClosed}),h.default.createElement("div",{id:"layer-list__content",ref:this.myRef}),this.state.selectedItem&&this.state.selectedItem.layer&&"feature"===this.state.selectedItem.layer.type&&"simple"===this.state.selectedItem.layer.renderer.type&&h.default.createElement(te,{onSave:this.changeStyle,layer:this.state.selectedItem.layer,open:this.state.layerStyleModalOpen,toggleOpen:()=>this.setState({layerStyleModalOpen:!this.state.layerStyleModalOpen})}),this.state.selectedItem&&this.state.selectedItem.layer&&h.default.createElement(oe,{layer:this.state.selectedItem.layer,open:this.state.moreInfoModalOpen,toggleOpen:()=>this.setState({moreInfoModalOpen:!this.state.moreInfoModalOpen}),getLayerInfo:this.props.getLayerInfo}))}}const le=ne;var ce=f(986),de={};de.styleTagTransform=p(),de.setAttributes=n(),de.insert=s().bind(null,"head"),de.domAPI=a(),de.insertStyleElement=c(),t()(ce.Z,de),ce.Z&&ce.Z.locals&&ce.Z.locals;class pe extends h.Component{render(){let e=this.props.activeTemplates.includes(this.props.template);if(e)for(let t of this.props.template.layerWrappers)if(!this.props.activeLayers.includes(t)){e=!1;break}return h.default.createElement(v.CollapsablePanel,{label:h.default.createElement(v.Button,{"aria-label":"Button",icon:!0,onClick:()=>this.props.onAddTemplate(this.props.template),size:"sm",type:"tertiary",disabled:0===this.props.template.layerWrappers.length||e,className:"add-button"},h.default.createElement(v.Icon,{icon:e?"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/check-32.svg":"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/plus-32.svg",size:"l"}),this.props.template.title+" ("+this.props.template.layerWrappers.length+")"),level:0,type:"default",disabled:0===this.props.template.layerWrappers.length},h.default.createElement("div",{className:"template-dropdown__content"},this.props.template.layerWrappers.map(((e,t)=>{let r=this.props.template.layerWrappers[this.props.template.layerWrappers.length-t-1];return h.default.createElement(z,{layerWrapper:r,onAddLayer:this.props.onAddLayer,active:this.props.activeLayers.includes(r)})}))))}}const ue=pe;class me extends h.Component{render(){return h.default.createElement("div",{id:"template-search"},h.default.createElement(v.AdvancedSelect,{isMultiple:!0,isEmptyOptionHidden:!0,onChange:function(){},size:"default",sortValuesByLabel:!0,menuProps:{offset:[0,-40]},customDropdownButtonContent:()=>h.default.createElement("div",null,h.default.createElement(v.Icon,{icon:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/search-32.svg"}),"Search for event..."),appendToBody:!1,strategy:"fixed",staticValues:this.props.templates.map((e=>({label:e.title,value:e.id,render:t=>h.default.createElement("span",{className:"template-search-item"},h.default.createElement(ue,{template:e,onAddTemplate:this.props.onAddTemplate,onAddLayer:this.props.onAddLayer,activeLayers:this.props.activeLayers,activeTemplates:this.props.activeTemplates}))})))}))}}const he=me;class ye extends h.Component{render(){return h.default.createElement("div",{id:"active-templates-menu"},0===this.props.activeTemplates.length&&h.default.createElement("div",{id:"no-active-templates"},h.default.createElement("em",null,"Added events will appear here.")),h.default.createElement(v.Tabs,{scrollable:!0,type:"pills"},this.props.activeTemplates.map((e=>h.default.createElement(v.Tab,{id:""+e.id,title:e.title+" ("+e.layerWrappers.length+")",onClose:()=>this.props.removeTemplate(e),closeable:!0})))))}}const fe=ye;class ge extends h.Component{constructor(e){super(e),this.state={paneOpen:!1,selectedTemplate:null}}render(){return h.default.createElement("div",{id:"template-component"},h.default.createElement("div",{id:"template-component__header"},h.default.createElement("h4",null,"Events"),h.default.createElement(v.Tooltip,{placement:"right",title:"Events are a set of layers that are grouped together for a specific emergency\n                        and can be added to the map all at once."},h.default.createElement("div",{id:"template-component__info"},h.default.createElement(v.Icon,{icon:"https://raw.githubusercontent.com/Esri/calcite-ui-icons/master/icons/question-32-f.svg"})))),this.props.templates&&h.default.createElement("div",{id:"template-component__content"},h.default.createElement(he,{templates:this.props.templates,onAddLayer:this.props.onAddLayer,onAddTemplate:this.props.onAddTemplate,activeLayers:this.props.activeLayers,activeTemplates:this.props.activeTemplates}),h.default.createElement(fe,{activeTemplates:this.props.activeTemplates,removeTemplate:this.props.onRemoveTemplate})))}}const ve=ge;var be=function(e,t,r,a){return new(r||(r=Promise))((function(i,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function n(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,n)}l((a=a.apply(e,t||[])).next())}))};class we extends h.Component{constructor(e){super(e),this.fetchCategories=()=>be(this,void 0,void 0,(function*(){let e=yield this.categoryTable.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["TITLE"]}),t=new Map;for(let r of e.features)t.set(r.attributes.OBJECTID,{id:r.attributes.OBJECTID,title:r.attributes.TITLE,layerWrappers:[]});this.setState({categories:t})})),this.fetchTemplates=()=>be(this,void 0,void 0,(function*(){let e=yield this.templateTable.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["TITLE"]}),t=new Map;for(let r of e.features)t.set(r.attributes.OBJECTID,{id:r.attributes.OBJECTID,title:r.attributes.TITLE,layerWrappers:[]});this.setState({templates:t})})),this.fetchLayers=()=>be(this,void 0,void 0,(function*(){let e=yield this.layerTable.queryFeatures({where:"1=1",outFields:["OBJECTID","TITLE","URL","SCOPE","CATEGORYID","RENDERER","FILTER"],orderByFields:["SCOPE","TITLE"]}),t=new Map;for(let r of e.features){let e={id:r.attributes.OBJECTID,title:r.attributes.SCOPE+" "+r.attributes.TITLE,url:r.attributes.URL,filter:r.attributes.FILTER,renderer:r.attributes.RENDERER,layer:null,category:this.state.categories.get(r.attributes.CATEGORYID),templates:[]};try{this.createLayer(e),t.set(r.attributes.OBJECTID,e),this.state.categories.get(r.attributes.CATEGORYID).layerWrappers.push(e)}catch(e){console.error(e),alert(e.message)}}this.setState({layerWrappers:t})})),this.fetchTemplateLayers=()=>be(this,void 0,void 0,(function*(){let e=yield this.templateLayerRelationships.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["OBJECTID"]});for(let t of e.features){let e=this.state.layerWrappers.get(t.attributes.LAYERID);if(e){let r=this.state.templates.get(t.attributes.TEMPLATEID);r.layerWrappers.push(e),this.state.layerWrappers.get(t.attributes.LAYERID).templates.push(r)}}this.setState({templates:this.state.templates,loading:!1})})),this.createLayer=e=>be(this,void 0,void 0,(function*(){try{let t=yield w.default.fromArcGISServerUrl({url:e.url});if(t.id=e.id.toString(),t.title=e.title,"feature"===t.type){if(null!=e.renderer)try{t.renderer=JSON.parse(e.renderer)}catch(t){console.log("Error loading renderer for layer "+e.title),console.error(t)}if(null!=e.filter)try{t.definitionExpression=e.filter}catch(t){console.log("Error loading SQL filter for layer "+e.title),console.error(t)}}return e.layer=t,t}catch(t){throw console.error(t),new Error("Error loading layer"+e.title+"!")}})),this.saveTemplate=e=>be(this,void 0,void 0,(function*(){try{if(e)if((yield this.templateTable.queryFeatureCount({where:"TITLE = '"+e+"'",outFields:["*"]}))>0)alert("Error, a template with this title already exists!");else{let t=yield this.getToken(),r=yield N({url:this.props.config.templateTableUrl,features:[{attributes:{TITLE:e}}],params:{token:t}});if(!r.addResults[0].success)throw new Error(r.addResults[0].error);let a=r.addResults[0].objectId;yield this.saveTemplateLayers(a,t),yield this.fetchTemplates(),yield this.fetchTemplateLayers(),alert("Successfully saved new event!")}else alert("Error, please enter a title!")}catch(e){console.error(e),alert("Error saving template, please try again!")}})),this.saveTemplateLayers=(e,t)=>be(this,void 0,void 0,(function*(){let r=[],a=this.state.jimuMapView.view.map.allLayers;for(let t of a)this.state.layerWrappers.has(+t.id)&&r.push({attributes:{TEMPLATEID:e,LAYERID:t.id}});let i=yield N({url:this.props.config.templateLayerRelationshipsUrl,features:r,params:{token:t}});if(!i.addResults[0].success)throw new Error(i.addResults[0].error)})),this.getToken=()=>be(this,void 0,void 0,(function*(){const e=new D.default({appId:"eS2vUdIZbHaVOrDz",flowType:"auto",popup:!1});j.default.registerOAuthInfos([e]);let t=yield j.default.checkSignInStatus(e.portalUrl+"/sharing");return t||(t=yield j.default.getCredential(e.portalUrl+"/sharing")),t.token})),this.addActiveLayer=e=>be(this,void 0,void 0,(function*(){if(e.layer||(yield this.createLayer(e)),!this.state.activeLayers.includes(e)){let t=this.state.activeLayers.slice();t.push(e),e.layer.visible=!0;try{this.state.jimuMapView.view.map.add(e.layer)}catch(t){alert("Error adding layer "+e.title+"!")}this.setState({activeLayers:t})}})),this.addActiveTemplate=e=>be(this,void 0,void 0,(function*(){let t=this.state.activeTemplates.slice(),r=this.state.activeLayers.slice();t.includes(e)||t.push(e);for(let t of e.layerWrappers)if(t.layer||(yield this.createLayer(t)),!r.includes(t)){r.push(t),t.layer.visible=!0;try{this.state.jimuMapView.view.map.add(t.layer)}catch(e){alert("Error adding layer "+t.title+"!")}}this.setState({activeTemplates:t,activeLayers:r})})),this.removeActiveLayer=e=>{let t=this.state.activeLayers.filter((t=>t.layer!==e)),r=this.state.activeTemplates;this.state.jimuMapView.view.map.remove(e);for(let a of r)if(this.state.layerWrappers.get(+e.id).templates.includes(a)){let e=!1;for(let r of a.layerWrappers)if(t.includes(r)){e=!0;break}e||(r=r.filter((e=>e!==a)))}this.setState({activeTemplates:r,activeLayers:t})},this.removeActiveTemplate=e=>{let t=this.state.activeLayers.slice(),r=this.state.activeTemplates.filter((t=>t!==e));for(let a of e.layerWrappers){let e=!1;for(let t of r)if(a.templates.includes(t)){e=!0;break}e||(t=t.filter((e=>e!==a)),this.state.jimuMapView.view.map.remove(a.layer))}this.setState({activeTemplates:r,activeLayers:t})},this.clearAll=()=>{this.state.jimuMapView.view.map.removeAll(),this.setState({activeTemplates:[],activeLayers:[]})},this.getLayerTemplates=(e,t)=>{if(!this.state.layerWrappers.get(+e.id))return[];if(t){let t=[];for(let r of this.state.layerWrappers.get(+e.id).templates)this.state.activeTemplates.includes(r)&&t.push(r);return t}return this.state.layerWrappers.get(+e.id).templates},this.getLayerCategory=e=>this.state.layerWrappers.get(+e.id)?this.state.layerWrappers.get(+e.id).category:null,this.getLayerInfo=e=>be(this,void 0,void 0,(function*(){try{if(!this.state.layerWrappers.get(+e.id))return null;let t=yield this.layerTable.queryFeatures({where:"OBJECTID = "+e.id,outFields:["SOURCE","DESCRIPTION"]});if(t.features.length>0)return{source:t.features[0].attributes.SOURCE,description:t.features[0].attributes.DESCRIPTION,url:this.state.layerWrappers.get(+e.id).url};throw new Error("No layers found with the given OBJECTID!")}catch(t){return alert("Error loading layer info!"),console.error(t),{source:"Error",description:"Error",url:this.state.layerWrappers.get(+e.id).url}}})),this.activeViewChangeHandler=e=>{e&&(this.state.jimuMapView||(e.view.map.basemap=E.default.fromId("arcgis-topographic")),this.setState({jimuMapView:e}))},this.state={jimuMapView:void 0,layerWrappers:new Map,templates:new Map,categories:new Map,loading:!0,activeTemplates:[],activeLayers:[]}}componentDidMount(){return be(this,void 0,void 0,(function*(){try{this.templateTable=new b.default({url:this.props.config.templateTableUrl}),this.layerTable=new b.default({url:this.props.config.layerTableUrl}),this.categoryTable=new b.default({url:this.props.config.categoryTableUrl}),this.templateLayerRelationships=new b.default({url:this.props.config.templateLayerRelationshipsUrl})}catch(e){return console.error(e),void alert("Error connecting to database, please try again!")}try{yield this.fetchCategories()}catch(e){return console.error(e),void alert("Error loading categories, please try again!")}try{yield this.fetchTemplates()}catch(e){return console.error(e),void alert("Error loading templates, please try again!")}try{yield this.fetchLayers()}catch(e){return console.error(e),void alert("Error loading layers, please try again!")}try{yield this.fetchTemplateLayers()}catch(e){return console.error(e),void alert("Error loading template layers, please try again!")}}))}render(){var e,t;return h.default.createElement("div",{className:"widget-starter jimu-widget"},this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&h.default.createElement(y.JimuMapViewComponent,{useMapWidgetId:null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0],onActiveViewChange:this.activeViewChangeHandler}),h.default.createElement("div",{id:"oem-dashboard-grid"},h.default.createElement("div",{id:"template-component__grid-item",className:"grid-item"},h.default.createElement("h3",null,"Add Layers"),h.default.createElement(ve,{templates:Array.from(this.state.templates.values()),activeTemplates:this.state.activeTemplates,onAddTemplate:this.addActiveTemplate,onRemoveTemplate:this.removeActiveTemplate,activeLayers:this.state.activeLayers,onAddLayer:this.addActiveLayer})),h.default.createElement("div",{id:"layer-component__grid-item",className:"grid-item"},this.state.loading&&h.default.createElement(v.Loading,{type:"SECONDARY"}),h.default.createElement(V,{layers:Array.from(this.state.layerWrappers.values()),categories:Array.from(this.state.categories.values()),activeLayers:this.state.activeLayers,onAddLayer:this.addActiveLayer})),h.default.createElement("div",{id:"layer-list__grid-item",className:"grid-item"},!(this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length)&&h.default.createElement(v.Loading,{type:"SECONDARY"}),this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&h.default.createElement(le,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onClearAll:this.clearAll,onRemoveLayer:this.removeActiveLayer,getLayerTemplates:this.getLayerTemplates,getLayerCategory:this.getLayerCategory,numActiveLayers:this.state.activeLayers.length,getLayerInfo:this.getLayerInfo})),h.default.createElement("div",{id:"save-template-grid-item",className:"grid-item"},h.default.createElement(Z,{handleClick:this.saveTemplate,show:this.state.activeLayers.length>0}))))}}const Ee=we;function Te(e){f.p=e}})(),g})())}}}));